# v17 학습 및 평가 보고서

## 개요

v16 ablation 실험(A1~A7) 결과를 토대로, 가장 효과적인 두 요인 **COCO pretrained(A5)** + **1280px(A4)**를 결합한 v17 모델.

## Ablation 실험 결과 (A1~A7, 20 epoch quick test)

| 실험 | 설명 | mAP50 | mAP50-95 | 비고 |
|------|------|-------|----------|------|
| A1 | v13 없이 3k만 | 0.7515 | 0.4421 | 데이터 부족 |
| A2 | v13 4k 추가 | 0.6988 | 0.3929 | 도메인 불일치 |
| A3 | v13 filtered | 0.6518 | 0.3476 | 더 악화 |
| **A4** | **imgsz=1280** | **0.8902** | **0.6301** | **큰 효과** |
| **A5** | **COCO pretrained** | **0.8861** | **0.5356** | **큰 효과** |
| A6 | heavy augmentation | 0.6615 | 0.3544 | 20ep에선 부족 |
| A7 | light augmentation | 0.6835 | 0.3860 | 20ep에선 부족 |

**결론**: A4(1280px)와 A5(COCO pt)가 압도적. 이 둘을 결합하여 v17 설계.

## v17 학습 설정

| 항목 | 값 |
|------|-----|
| 시작 가중치 | yolo26m.pt (COCO pretrained) |
| 이미지 크기 | 1280px |
| 배치 크기 | 6 |
| 최대 에포크 | 100 (patience=20) |
| 옵티마이저 | SGD (lr0=0.005, cos_lr) |
| 데이터 | datasets_go3k_v16 (3k clean) |
| GPU | RTX 4080 16GB |

### 학습 결과

- **총 61 에포크** (patience=20 triggered)
- **Best epoch 41**: mAP50=0.9583, mAP50-95=0.7223
- 학습 시간: ~10시간

## SAHI F1 평가

v17 best.pt를 SAHI(1280x720 타일, overlap=0.15, NMS/IOS)로 평가.

### SET A: 3k val 641장 (v16 동일 비교)

| conf | Precision | Recall | F1 | TP | FP | FN |
|------|-----------|--------|------|-----|-----|-----|
| 0.30 | 0.835 | 0.980 | 0.902 | 1051 | 207 | 21 |
| 0.35 | 0.853 | 0.977 | 0.911 | 1047 | 180 | 25 |
| 0.40 | 0.869 | 0.972 | 0.918 | 1042 | 157 | 30 |
| **0.45** | **0.876** | **0.966** | **0.919** | **1036** | **147** | **36** |
| 0.50 | 0.882 | 0.954 | 0.917 | 1023 | 137 | 49 |
| 0.55 | 0.896 | 0.939 | 0.917 | 1007 | 117 | 65 |

Per-class 최적 (c0=0.45, c1=0.40):
- helmet_on: P=0.878, R=0.969, F1=0.921
- helmet_off: P=0.831, R=0.937, F1=0.881

### SET B: Combined 729장 (3k val + verified helmet_off 88장)

3k val의 helmet_off bbox가 79개로 적어 신뢰성 부족 → CVAT 검증된 helmet_off 88장(105 bbox) 추가.

| conf | Precision | Recall | F1 | TP | FP | FN |
|------|-----------|--------|------|-----|-----|-----|
| 0.35 | 0.850 | 0.962 | 0.903 | 1222 | 215 | 48 |
| **0.40** | **0.867** | **0.955** | **0.909** | **1213** | **186** | **57** |
| 0.45 | 0.874 | 0.946 | 0.908 | 1201 | 173 | 69 |
| 0.50 | 0.884 | 0.933 | 0.908 | 1185 | 155 | 85 |

Per-class 최적 (c0=0.45, c1=0.35):
- helmet_on: P=0.873, R=0.960, F1=0.915
- helmet_off: P=0.868, R=0.897, F1=0.882

## 모델 비교

| 모델 | SAHI F1 (uniform) | SAHI F1 (per-class) | 비고 |
|------|-------------------|---------------------|------|
| v16 (640px, v16 pt) | 0.885 | 0.898 | baseline |
| **v17 (1280px, COCO pt)** | **0.919** | **0.918** | **+3.4%p / +2.0%p** |

## 핵심 개선 요인

1. **COCO pretrained**: 범용 특징 추출 → 소규모 데이터(3k)에서 효과적
2. **1280px 학습**: 작은 객체(먼 거리의 헬멧) 탐지력 향상
3. **SGD + patience=20**: 과적합 없이 안정적 수렴

## 추가 작업: helmet_off 데이터 증강

### 배경
- 3k val에 helmet_off bbox 79개(7.4%) → 평가 신뢰성 낮음
- captures(cam1/cam2)에서 v16+SAHI로 helmet_off 탐지 → CVAT 검증

### 검증 결과
- CVAT 업로드: 137장 → 검증 후 88장 유효
- YOLO 변환: 86장, 198 bbox (helmet_on: 93, helmet_off: 105)
- 통합 val set: 729장, 1,270 bbox (helmet_off: 184, 14.5%)

### 영향
- SET B에서 F1이 0.919→0.909로 하락 → 추가된 데이터에 어려운 케이스 포함
- helmet_off 클래스 F1은 0.881→0.882로 안정 → 모델 일반화 양호
