# SAHI 파라미터 스윕 결과 (v26 3-class)

## 실험 목적

v26 모델(현재 최고 3-class)의 SAHI 추론 파라미터를 튜닝하여 helmet F1 개선 가능성 확인.

## 실험 조건

- **모델**: `hoban_go3k_v26/weights/best.pt` (yolo26m, 3-class)
- **평가셋**: 605장 (helmet val 488 + helmet_off 88 + neg 29)
- **후처리**: cross_class_nms(0.3) → min_area(5e-5) → gate(conf=0.20, r=30) → per_class conf sweep
- **기준 설정 (baseline)**: slice=1280x720, overlap=0.15, NMS thresh=0.4, IOS metric, standard_pred=True

## 스윕 파라미터

| 카테고리 | 테스트 값 |
|----------|-----------|
| 타일 크기 | 640x360, 960x540, **1280x720** |
| Overlap | **0.15**, 0.25, 0.30 |
| 후처리 타입 | **NMS**, GREEDYNMM |
| 후처리 임계값 | 0.3, **0.4**, 0.5 |
| 메트릭 | IOU, **IOS** |
| Standard pred | True, **False** |

(**굵은 글씨** = baseline 값)

## 결과 (F1 기준 정렬)

| # | 설정 | F1 | P | R | ON_F1 | OFF_F1 | FP | FN | 시간 |
|---|------|-----|-------|-------|-------|--------|----|----|------|
| 1 | **pp_thresh_0.3** | **0.9584** | 0.958 | 0.959 | 0.966 | 0.924 | 39 | 38 | 151s |
| 2 | baseline | 0.9579 | 0.957 | 0.959 | 0.965 | 0.924 | 40 | 38 | 149s |
| 3 | overlap_0.25 | 0.9579 | 0.957 | 0.959 | 0.965 | 0.924 | 40 | 38 | 149s |
| 4 | overlap_0.30 | 0.9579 | 0.957 | 0.959 | 0.965 | 0.924 | 40 | 38 | 151s |
| 5 | pp_thresh_0.5 | 0.9574 | 0.956 | 0.959 | 0.965 | 0.924 | 41 | 38 | 150s |
| 6 | tile_960_ov0.25 | 0.9558 | 0.954 | 0.958 | 0.965 | 0.914 | 43 | 39 | 252s |
| 7 | tile_640_ov0.25 | 0.9551 | 0.957 | 0.954 | 0.965 | 0.911 | 40 | 43 | 365s |
| 8 | tile_960x540 | 0.9546 | 0.954 | 0.956 | 0.964 | 0.914 | 43 | 41 | 254s |
| 9 | metric_IOU | 0.9543 | 0.950 | 0.959 | 0.961 | 0.922 | 47 | 38 | 150s |
| 10 | tile_640x360 | 0.9508 | 0.950 | 0.951 | 0.960 | 0.914 | 46 | 45 | 363s |
| 11 | no_std_pred | 0.9479 | 0.952 | 0.944 | 0.954 | 0.919 | 44 | 52 | 114s |
| 12 | pp_GREEDYNMM | 0.9320 | 0.924 | 0.941 | 0.935 | 0.919 | 72 | 55 | 151s |

## 분석

### 1. 타일 크기
- **1280x720이 최적**. 960x540(-0.3%p), 640x360(-0.7%p)로 줄일수록 성능 하락.
- 작은 타일은 OFF_F1 하락이 주 원인 (0.924 → 0.914).
- 타일이 작으면 추론 시간 2~2.5배 증가 (149s → 365s).

### 2. Overlap 비율
- 0.15/0.25/0.30 **모두 동일 결과** (F1=0.9579).
- 1280x720 타일에서는 overlap이 성능에 영향 없음.

### 3. 후처리 타입 및 임계값
- **NMS가 GREEDYNMM보다 크게 우수** (F1 +2.6%p, FP -33개).
- NMS 임계값: 0.3이 미세하게 최적 (FP 39 vs 40), 0.4/0.5도 거의 동일.

### 4. 메트릭 (IOS vs IOU)
- **IOS가 IOU보다 우수** (+0.4%p). IOU는 FP 7개 더 많음.

### 5. Standard Prediction
- **standard_pred=True 필수** (+1%p). False 시 FN 14개 증가.

## 결론

| 항목 | 최적 값 | 현재 값 | 차이 |
|------|---------|---------|------|
| 타일 크기 | 1280x720 | 1280x720 | 동일 |
| Overlap | 0.15 | 0.15 | 동일 |
| 후처리 | NMS | NMS | 동일 |
| NMS 임계값 | **0.3** | 0.4 | -0.1 |
| 메트릭 | IOS | IOS | 동일 |
| Standard pred | True | True | 동일 |

**현재 SAHI 설정은 거의 최적.**
- 유일한 개선점: NMS 임계값 0.4→0.3 (FP 1개 감소, F1 +0.0005)
- 실질적으로 무의미한 차이로, **현재 설정 유지 권장**

## 핵심 인사이트

> SAHI 파라미터 튜닝으로는 F1 0.958 이상 개선 불가.
> 성능 향상을 위해서는 모델 자체(학습 데이터/아키텍처) 개선이 필요.
