# SAHI 타일 크기별 성능 비교

> 2026-02-15 실험

## 실험 조건

| 항목 | 값 |
|------|-----|
| 모델 | `hoban_go2k_v2/weights/best.pt` |
| GT | go2k_manual 604장, 1,680 bbox |
| conf | 0.50 |
| overlap | 0.2 (1920x1080 제외, overlap=0.0) |
| postprocess | NMS / match_threshold=0.4 / IOS |
| 스크립트 | `eval_tile_size.py` |

## 결과

| 타일 크기 | 예측 | TP | FP | FN | Prec | Recall | F1 | 시간 |
|---|---:|---:|---:|---:|---:|---:|---:|---:|
| 풀이미지 640px (no SAHI) | 1,494 | 1,449 | 45 | 231 | 0.970 | 0.863 | 0.913 | - |
| 640x640 (이전 설정) | 2,092 | 1,517 | 575 | 163 | 0.725 | 0.903 | 0.804 | 148s |
| 800x800 | 1,835 | 1,508 | 327 | 172 | 0.822 | 0.898 | 0.858 | 124s |
| 960x540 (2x2) | 1,820 | 1,560 | 260 | 120 | 0.857 | 0.929 | 0.891 | 148s |
| 960x960 | 1,836 | 1,553 | 283 | 127 | 0.846 | 0.924 | 0.883 | 134s |
| **1280x720 (채택)** | **1,790** | **1,582** | **208** | **98** | **0.884** | **0.942** | **0.912** | **94s** |
| 1920x1080 (풀이미지 SAHI) | 1,491 | 1,449 | 42 | 231 | 0.972 | 0.863 | 0.914 | 29s |

## 분석

### 1280x720 채택 근거

640x640 → 1280x720 변경 효과:

| 지표 | 640x640 | 1280x720 | 변화 |
|------|---------|----------|------|
| F1 | 0.804 | **0.912** | **+10.8%p** |
| Precision | 0.725 | **0.884** | **+15.9%p** |
| Recall | 0.903 | **0.942** | **+3.9%p** |
| FP | 575 | **208** | **-64%** |
| FN | 163 | **98** | **-40%** |
| TP | 1,517 | **1,582** | **+65** |
| 추론 시간 | 148s | **94s** | **-36%** |

- 모든 지표에서 개선. FP 64% 감소 + Recall도 오히려 상승.
- Full-Image Gate(F1=0.880)보다 높은 F1=0.912를 게이트 없이 달성.
- 추론 속도도 36% 빨라짐 (타일 수 감소: 8→4).

### 타일 크기 트렌드

- **타일 작을수록**: FP 증가 (배경 잘라낸 타일에서 오탐), FN 감소 (소형 객체 확대)
- **타일 클수록**: FP 감소 (맥락 정보 보존), FN 증가 (소형 객체 놓침)
- **1280x720이 sweet spot**: FP 최소화하면서 Recall이 가장 높음 (0.942)
- 640x640은 과도한 타일링으로 FP가 575개 발생 — 타일 경계 중복 + 맥락 부족

### 풀이미지 vs SAHI 비교

- 풀이미지 640px (no SAHI): Recall=0.863 — 소형 객체 231개 미탐
- 1920x1080 SAHI (1타일): 풀이미지와 거의 동일 — 타일 1개면 SAHI 의미 없음
- 1280x720 SAHI (4타일): Recall=0.942로 소형 객체 탐지 능력 유지하면서 FP 억제

## 결론

SAHI 타일 크기를 640x640에서 **1280x720**으로 변경.
게이트 없이도 F1=0.912 달성. 추론 파이프라인 단순화 가능.
